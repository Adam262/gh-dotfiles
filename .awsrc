# use via aws-vault exec support <my command>

export AWS_DEFAULT_PROFILE="dev.usw2"
export AWS_PROFILE="dev.usw2"
export AWS_VAULT_BACKEND=file
export AWS_SDK_LOAD_CONFIG=true

aws-use() {
  local profile 
  profile="${3:-"dev.usw2"}";

  export AWS_PROFILE="$profile"
}

alias aws-logout='export AWS_VAULT="" && aws-vault remove -s support'
alias aws-sessions='aws-vault list | grep sso'

aws-ssm-set () {
  local name value profile;
  name="$1";
  value="$2";
  profile="${3:-"dev.usw2"}";

  aws ssm put-parameter --name "$name" --type SecureString --value "$value" --profile "$profile" --overwrite
}

aws-ssm-get () {
  local name profile;
  name="$1";
  profile="${2:-"dev.usw2"}";
  aws ssm get-parameter --name "$name" --profile "$profile" --with-decryption
}

aws-ssm-del () {
  local name profile;
  name="$1";
  profile="${2:-"dev.usw2"}";
  aws ssm delete-parameter --name "$name" --profile "$profile"
}

aws-ssm-copy () {
  local name profile;
  name="$1"
  profile="${2:-"dev.usw2"}";

  # jq -r is needed for raw string output
  aws-get-ssm $name $profile | jq -r '.Parameter.Value' | pbcopy
}

aws-ssm-paste() {
  local name profile;
  name="$1"
  profile="${2:-"dev.usw2"}";

  # quotes around subshell make sure all whitespace gets preserved as-is
  aws-ssm-set $name "$(pbpaste)" $profile 
}

aws-list-profiles() {
   aws configure list-profiles | grep -v vaulted-
}
 